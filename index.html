<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>面試框架</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* 隱藏滾動條 */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        body {
            background-color: #f8fafc;
            padding-bottom: env(safe-area-inset-bottom);
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* 針對 iPhone 安全區域適配 */
        .safe-top { padding-top: env(safe-area-inset-top); }
        
        /* 卡片進場動畫 */
        .card-enter {
            animation: slideIn 0.3s ease-out forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const DEFAULT_DATA = [
            { section: "自我介紹", title: "14年經驗與三個階段", content_zh: "我是一位擁有 PMP 證照、具備 14 年跨領域經驗的專案與數位轉型工作者，主要專長是把複雜的流程與系統，轉換成可交付、可治理、可規模化的結構。", content_en: "I’m a PMP-certified program and transformation professional with over 14 years of experience. My core strength is turning complex processes into predictable and scalable structures." },
            { section: "離職原因", title: "商智資訊 SoftBI", content_zh: "我完成了當初加入時被賦予的使命。我意識到自己已經走完了在中小企業「從 0 到 1」的旅程。", content_en: "I completed the mission I was hired for at SoftBI. I realized I had completed my full SME career loop — from zero to one." },
            { section: "困難題 (SEEI)", title: "最大缺點 (切換成本)", content_zh: "S｜我常被問：要做執行還是治理？\nE｜挑戰在於不同階段切換比例。\nE｜以商智為例，先親自釐清規則才建立治理制度。\nI｜前期落地、後期規模化。", content_en: "S｜My weakness is operating in two modes: hands-on and governance.\nE｜The challenge is balancing these across phases.\nE｜At SoftBI, I went hands-on to build the logic before scaling to automation.\nI｜I treat this as a controlled strategy." }
        ];

        const SECTIONS = ["自我介紹", "離職原因", "優缺點(STAR)", "困難題 (SEEI)", "反問問題"];

        function App() {
            const [data, setData] = useState(() => {
                const saved = localStorage.getItem('interview_data');
                return saved ? JSON.parse(saved) : DEFAULT_DATA;
            });
            const [activeSection, setActiveSection] = useState(SECTIONS[0]);
            const [isEditing, setIsEditing] = useState(null); 
            const [editForm, setEditForm] = useState({ section: '', title: '', content_zh: '', content_en: '' });
            const [gasUrl, setGasUrl] = useState(localStorage.getItem('gas_url') || '');
            const [isSyncing, setIsSyncing] = useState(false);
            const [speechRate, setSpeechRate] = useState(0.9);
            const [showSettings, setShowSettings] = useState(false);

            useEffect(() => {
                localStorage.setItem('interview_data', JSON.stringify(data));
            }, [data]);

            useEffect(() => {
                localStorage.setItem('gas_url', gasUrl);
            }, [gasUrl]);

            const speak = (text) => {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = speechRate;
                window.speechSynthesis.speak(utterance);
            };

            const pullData = async () => {
                if (!gasUrl) return alert("請先在設定中輸入 Google 試算表同步網址 (GAS URL)");
                setIsSyncing(true);
                try {
                    const resp = await fetch(gasUrl);
                    const json = await resp.json();
                    if (Array.isArray(json)) {
                        setData(json);
                        alert("同步成功！資料已更新。");
                    }
                } catch (e) {
                    alert("同步失敗，請檢查網址或權限設定。");
                } finally {
                    setIsSyncing(false);
                }
            };

            const pushData = async () => {
                if (!gasUrl) return alert("請先在設定中輸入 Google 試算表同步網址 (GAS URL)");
                setIsSyncing(true);
                try {
                    await fetch(gasUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    alert("已發送更新請求，請至試算表確認。");
                } catch (e) {
                    alert("上傳失敗：" + e.message);
                } finally {
                    setIsSyncing(false);
                }
            };

            const handleEdit = (index) => {
                setIsEditing(index);
                setEditForm(data[index]);
            };

            const handleAddNew = () => {
                setIsEditing('new');
                setEditForm({ section: activeSection, title: '', content_zh: '', content_en: '' });
            };

            const saveEdit = () => {
                if (!editForm.title || !editForm.content_zh) return alert("請填寫標題與內容");
                const newData = [...data];
                if (isEditing === 'new') {
                    newData.push(editForm);
                } else {
                    newData[isEditing] = editForm;
                }
                setData(newData);
                setIsEditing(null);
            };

            const deleteItem = (index) => {
                if (window.confirm("確定要刪除這張卡片嗎？此操作無法還原。")) {
                    const newData = data.filter((_, i) => i !== index);
                    setData(newData);
                    setIsEditing(null);
                }
            };

            const SettingsIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
            const PlayIcon = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>;
            const EditIcon = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>;
            const PlusIcon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;

            return (
                <div className="min-h-screen flex flex-col max-w-md mx-auto bg-slate-50 relative overflow-x-hidden">
                    
                    {/* 凍結頂部區塊 (Sticky Wrapper) */}
                    <div className="sticky top-0 z-40 bg-white shadow-sm border-b">
                        {/* 頂部標題 */}
                        <header className="px-5 pt-3 pb-3 flex justify-between items-center safe-top">
                            <div className="flex flex-col">
                                <h1 className="text-xl font-black text-slate-900 tracking-tighter leading-none">面試框架</h1>
                                <span className="text-[10px] text-blue-600 font-bold uppercase tracking-[0.1em] mt-1">Interview Coach</span>
                            </div>
                            <button onClick={() => setShowSettings(!showSettings)} className={`p-2 rounded-xl transition-all ${showSettings ? 'bg-blue-600 text-white shadow-md shadow-blue-200' : 'bg-slate-100 text-slate-500 active:scale-90'}`}>
                                <SettingsIcon />
                            </button>
                        </header>

                        {/* 設定面板 (展開時也是固定頂部) */}
                        {showSettings && (
                            <div className="px-5 pb-5 space-y-4 animate-in slide-in-from-top duration-200">
                                <div>
                                    <label className="block text-[10px] font-black text-slate-400 uppercase mb-1.5 ml-1">GAS 同步網址</label>
                                    <input value={gasUrl} onChange={(e) => setGasUrl(e.target.value)} placeholder="https://script.google.com/..." className="w-full p-3 bg-slate-50 rounded-xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-xs" />
                                </div>
                                <div className="flex gap-4">
                                    <div className="flex-1">
                                        <label className="block text-[10px] font-black text-slate-400 uppercase mb-1.5 ml-1">語速: {speechRate}</label>
                                        <input type="range" min="0.5" max="1.5" step="0.1" value={speechRate} onChange={(e) => setSpeechRate(parseFloat(e.target.value))} className="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600" />
                                    </div>
                                    <div className="flex gap-2 items-end">
                                        <button onClick={pullData} disabled={isSyncing} className="bg-blue-600 text-white px-3 py-2 rounded-lg text-[10px] font-black active:scale-95 disabled:bg-slate-300">下載</button>
                                        <button onClick={pushData} disabled={isSyncing} className="bg-emerald-600 text-white px-3 py-2 rounded-lg text-[10px] font-black active:scale-95 disabled:bg-slate-300">上傳</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* 分類標籤 (Grid 佈局，無滾動) */}
                        <div className="p-2 pt-0">
                            <nav className="grid grid-cols-4 gap-1.5">
                                {SECTIONS.map(s => (
                                    <button 
                                        key={s} 
                                        onClick={() => setActiveSection(s)} 
                                        className={`py-2 px-1 rounded-lg text-[10px] font-bold transition-all text-center leading-tight border ${
                                            activeSection === s 
                                            ? 'bg-slate-900 text-white border-slate-900 shadow-md' 
                                            : 'bg-white text-slate-400 border-slate-100 active:bg-slate-50'
                                        }`}
                                    >
                                        {s}
                                    </button>
                                ))}
                            </nav>
                        </div>
                    </div>

                    {/* 卡片列表 (捲動區域) */}
                    <main className="flex-1 p-4 space-y-4">
                        {data.map((item, index) => ({ ...item, originalIndex: index }))
                            .filter(item => item.section === activeSection)
                            .map((item) => (
                                <div key={item.originalIndex} className="bg-white rounded-[24px] p-5 shadow-sm border border-slate-100/50 flex flex-col gap-4 card-enter">
                                    <div className="flex justify-between items-start">
                                        <div className="flex flex-col gap-1">
                                            <span className="text-[9px] font-black text-blue-500 uppercase tracking-widest">{item.section}</span>
                                            <h3 className="font-bold text-slate-900 text-lg leading-tight">{item.title}</h3>
                                        </div>
                                        <button onClick={() => handleEdit(item.originalIndex)} className="p-2 rounded-xl bg-slate-50 text-slate-300 active:text-blue-600 transition-colors">
                                            <EditIcon />
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div className="text-slate-600 text-sm leading-relaxed bg-slate-50/50 p-4 rounded-2xl border-l-4 border-slate-200 whitespace-pre-wrap">
                                            {item.content_zh}
                                        </div>
                                        <div className="text-slate-900 text-[15px] font-bold leading-relaxed p-5 rounded-2xl bg-blue-50/40 border border-blue-100/30 relative group whitespace-pre-wrap">
                                            {item.content_en}
                                            <div className="flex justify-end mt-4">
                                                <button onClick={() => speak(item.content_en)} className="flex items-center gap-2 bg-white shadow-sm px-4 py-2 rounded-full border border-blue-100 active:scale-95 transition-all">
                                                    <PlayIcon />
                                                    <span className="text-[10px] font-black uppercase text-blue-600">朗讀腳本</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        
                        <button onClick={handleAddNew} className="w-full py-6 border-2 border-dashed border-slate-200 rounded-[24px] text-slate-400 font-bold flex items-center justify-center gap-2 active:bg-white active:border-blue-400 active:text-blue-600 transition-all">
                            <PlusIcon /> <span className="text-sm">新增面試腳本</span>
                        </button>
                    </main>

                    {/* 編輯彈窗 */}
                    {isEditing !== null && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-slate-900/60 backdrop-blur-sm p-0 sm:p-4">
                            <div className="bg-white w-full max-w-md rounded-t-[32px] sm:rounded-[32px] shadow-2xl p-8 animate-in slide-in-from-bottom duration-300 flex flex-col gap-5 max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-xl font-black text-slate-900">{isEditing === 'new' ? '新增面試腳本' : '編輯面試腳本'}</h2>
                                    <button onClick={() => setIsEditing(null)} className="p-2 rounded-xl bg-slate-100 text-slate-400">✕</button>
                                </div>
                                <div className="space-y-4">
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-black text-slate-400 ml-1">分類</label>
                                        <select className="w-full p-3.5 bg-slate-50 rounded-xl border-none ring-1 ring-slate-100 focus:ring-2 focus:ring-blue-500 font-bold" value={editForm.section} onChange={e => setEditForm({...editForm, section: e.target.value})}>
                                            {SECTIONS.map(s => <option key={s} value={s}>{s}</option>)}
                                        </select>
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-black text-slate-400 ml-1">標題</label>
                                        <input placeholder="輸入標題" className="w-full p-3.5 bg-slate-50 rounded-xl border-none ring-1 ring-slate-100 focus:ring-2 focus:ring-blue-500 font-bold" value={editForm.title} onChange={e => setEditForm({...editForm, title: e.target.value})} />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-black text-slate-400 ml-1">中文內容</label>
                                        <textarea placeholder="輸入中文腳本..." rows="4" className="w-full p-3.5 bg-slate-50 rounded-xl border-none ring-1 ring-slate-100 focus:ring-2 focus:ring-blue-500 text-sm" value={editForm.content_zh} onChange={e => setEditForm({...editForm, content_zh: e.target.value})} />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-black text-slate-400 ml-1">英文回答 (可朗讀)</label>
                                        <textarea placeholder="輸入英文腳本..." rows="4" className="w-full p-3.5 bg-blue-50/50 rounded-xl border-none ring-1 ring-blue-100 focus:ring-2 focus:ring-blue-500 text-sm font-bold" value={editForm.content_en} onChange={e => setEditForm({...editForm, content_en: e.target.value})} />
                                    </div>
                                </div>
                                <div className="flex gap-3 pt-2">
                                    {isEditing !== 'new' && (
                                        <button onClick={() => deleteItem(isEditing)} className="flex-1 py-4 bg-red-50 text-red-600 rounded-2xl font-black active:scale-95 text-xs uppercase tracking-widest">
                                            刪除卡片
                                        </button>
                                    )}
                                    <button onClick={saveEdit} className="flex-[2] py-4 bg-blue-600 text-white rounded-2xl font-black shadow-lg shadow-blue-200 active:scale-95 text-xs uppercase tracking-widest">
                                        儲存變更
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 同步遮罩 */}
                    {isSyncing && (
                        <div className="fixed inset-0 bg-white/95 z-[100] flex flex-col items-center justify-center backdrop-blur-xl">
                            <div className="w-12 h-12 border-8 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                            <p className="mt-6 font-black text-slate-800 text-sm tracking-widest">雲端資料同步中</p>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
